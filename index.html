<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤ì°¨ì› ì „íˆ¬ë ¥ í‰ê°€ ì‹œìŠ¤í…œ RPG ì „íˆ¬</title>
    <style>
        :root {
            --primary-color: #422800;
            --secondary-color: #a98467;
            --accent-color: #bc6c25;
            --background-color: #ede0d4;
            --grid-color: #ddbea9;
            --player-color: #0077b6;
            --enemy-color: #d62828;
            --highlight-color: #ffb703;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--primary-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        .game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .battle-grid {
            flex: 2;
            min-width: 600px;
            height: 600px;
            background-color: #5a3921;
            border: 2px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="50" height="50" x="0" y="0" fill="%23654321" /><rect width="50" height="50" x="50" y="50" fill="%23654321" /><rect width="50" height="50" x="50" y="0" fill="%23765432" /><rect width="50" height="50" x="0" y="50" fill="%23765432" /></svg>');
            background-size: 60px 60px;
        }

        .cell {
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .cell:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .cell.highlight {
            background-color: rgba(255, 215, 0, 0.3);
        }

        .wall {
            background-color: #2f2f2f;
        }

        .water {
            background-color: #4a80bd;
        }

        .high-ground {
            background-color: #8d6e63;
        }

        .character {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .character.active {
            box-shadow: 0 0 10px 5px var(--highlight-color);
        }

        .player {
            background-color: var(--player-color);
            color: white;
            border: 2px solid #004c8c;
        }

        .enemy {
            background-color: var(--enemy-color);
            color: white;
            border: 2px solid #9e0000;
        }

        .ui-panel {
            flex: 1;
            min-width: 350px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .character-sheet, .action-panel, .log-panel, .terrain-tools, .create-character, .turn-info {
            background-color: #f5f5f5;
            border: 1px solid var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .character-sheet h3, .action-panel h3, .log-panel h3, .terrain-tools h3, .create-character h3, .turn-info h3 {
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 8px;
            margin-bottom: 10px;
        }

        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stats-group {
            margin-bottom: 10px;
        }

        .stats-group h4 {
            margin-bottom: 5px;
            color: var(--accent-color);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat {
            display: flex;
            justify-content: space-between;
        }

        .stat-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 3px;
            position: relative;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px 0;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: #a85c21;
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .btn-terrain {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            font-size: 20px;
        }

        .log-content {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 8px;
            background-color: #fff;
            font-size: 14px;
        }

        .log-entry {
            margin-bottom: 4px;
            padding-bottom: 4px;
            border-bottom: 1px solid #eee;
        }

        .log-player {
            color: var(--player-color);
        }

        .log-enemy {
            color: var(--enemy-color);
        }

        .log-system {
            color: #555;
            font-style: italic;
        }

        .log-turn {
            color: var(--highlight-color);
            font-weight: bold;
        }

        .health-bar {
            height: 15px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            background-color: #e63946;
            width: 100%;
            transition: width 0.3s ease;
        }

        .create-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .form-group {
            margin-bottom: 8px;
        }

        .form-group label {
            display: block;
            margin-bottom: 3px;
            font-weight: bold;
            font-size: 12px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-group input[type="number"] {
            width: 60px;
        }

        .ability-section {
            margin-top: 10px;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }

        .ability-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .ability-label {
            width: 100px;
            font-weight: bold;
            font-size: 12px;
        }

        .ability-value {
            width: 60px;
        }

        .ability-description {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
        }

        .turn-info {
            background-color: #f8f9fa;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            padding: 10px;
        }

        .turn-player {
            color: var(--player-color);
        }

        .turn-enemy {
            color: var(--enemy-color);
        }

        .action-counters {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            background-color: #f0f0f0;
            padding: 8px;
            border-radius: 4px;
        }

        .counter-item {
            text-align: center;
        }

        .counter-value {
            font-weight: bold;
            font-size: 20px;
        }

        .counter-label {
            font-size: 12px;
            color: #666;
        }

        .rank-badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: white;
            margin-left: 10px;
        }

        .rank-S-plus { background-color: #9d4edd; }
        .rank-S { background-color: #7b2cbf; }
        .rank-A-plus { background-color: #5a189a; }
        .rank-A { background-color: #3c096c; }
        .rank-B-plus { background-color: #240046; }
        .rank-B { background-color: #10002b; }
        .rank-C-plus { background-color: #3a5a40; }
        .rank-C { background-color: #344e41; }
        .rank-D { background-color: #6c757d; }
        .rank-E { background-color: #adb5bd; }
        .rank-F { background-color: #ced4da; }

        .attack-range {
            background-color: rgba(255, 0, 0, 0.2);
        }

        .move-range {
            background-color: rgba(0, 255, 0, 0.2);
        }

        #skillList, #itemList {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .skill-item, .item-item {
            padding: 5px 10px;
            margin-bottom: 5px;
            cursor: pointer;
            border-radius: 4px;
        }

        .skill-item:hover, .item-item:hover {
            background-color: #f0f0f0;
        }

        .keyboard-controls {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            font-size: 14px;
        }

        .keyboard-controls ul {
            list-style-type: none;
            padding-left: 15px;
        }

        .key {
            display: inline-block;
            padding: 2px 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            border: 1px solid #ccc;
            font-family: monospace;
            margin: 0 3px;
        }

        @media (max-width: 950px) {
            .game-container {
                flex-direction: column;
            }
            .battle-grid {
                min-width: 100%;
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>ë‹¤ì°¨ì› ì „íˆ¬ë ¥ í‰ê°€ ì‹œìŠ¤í…œ RPG ì „íˆ¬</h1>
        <p>ë°©í–¥í‚¤ë¡œ ìºë¦­í„°ë¥¼ ì´ë™ì‹œí‚¤ê³ , í„´ì œ ì „íˆ¬ ì‹œìŠ¤í…œìœ¼ë¡œ ì „íˆ¬ë¥¼ ì§„í–‰í•˜ì„¸ìš”.</p>
    </header>

    <div class="game-container">
        <div class="battle-grid">
            <div class="grid" id="battleGrid"></div>
        </div>

        <div class="ui-panel">
            <div class="turn-info" id="turnInfo">
                <div id="currentTurn">ê²Œì„ ì‹œì‘ ì „</div>
                <div class="action-counters" id="actionCounters" style="display: none;">
                    <div class="counter-item">
                        <div class="counter-value" id="moveCounter">0/1</div>
                        <div class="counter-label">ì´ë™</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-value" id="attackCounter">0/1</div>
                        <div class="counter-label">ê³µê²©</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-value" id="skillCounter">0/1</div>
                        <div class="counter-label">ìŠ¤í‚¬</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-value" id="itemCounter">0/1</div>
                        <div class="counter-label">ì•„ì´í…œ</div>
                    </div>
                </div>
            </div>

            <div class="create-character" id="createCharacterPanel">
                <h3>ìºë¦­í„° ìƒì„±</h3>
                <div class="create-form">
                    <div class="form-group">
                        <label for="charName">ì´ë¦„</label>
                        <input type="text" id="charName" value="ìš©ì‚¬">
                    </div>
                    <div class="form-group">
                        <label for="charType">ìœ í˜•</label>
                        <select id="charType">
                            <option value="player">í”Œë ˆì´ì–´</option>
                            <option value="enemy">ì </option>
                        </select>
                    </div>
                </div>

                <div class="ability-section">
                    <h4>ë¬¼ë¦¬ì  ëŠ¥ë ¥</h4>
                    <div class="ability-row">
                        <span class="ability-label">STR (í˜)</span>
                        <input type="number" class="ability-value" id="strStat" value="50" min="1" max="100">
                        <span class="ability-description">ë¬¼ë¦¬ì  í˜, íƒ€ê²©ë ¥, ë¬´ê¸° ë‹¤ë£¨ê¸°</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">AGI (ë¯¼ì²©)</span>
                        <input type="number" class="ability-value" id="agiStat" value="50" min="1" max="100">
                        <span class="ability-description">ì†ë„, ë°˜ì‘ ì‹œê°„, íšŒí”¼ ëŠ¥ë ¥</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">VIT (ì²´ë ¥)</span>
                        <input type="number" class="ability-value" id="vitStat" value="50" min="1" max="100">
                        <span class="ability-description">ë‚´êµ¬ì„±, ìƒì²˜ íšŒë³µ, í”¼ë¡œ ì €í•­</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">TEC (ê¸°ìˆ )</span>
                        <input type="number" class="ability-value" id="tecStat" value="50" min="1" max="100">
                        <span class="ability-description">ì „íˆ¬ ê¸°ìˆ , ë¬´ê¸° ìˆ™ë ¨ë„, ì •í™•ë„</span>
                    </div>
                </div>

                <div class="ability-section">
                    <h4>ì´ˆìì—°ì /íŠ¹ìˆ˜ ëŠ¥ë ¥</h4>
                    <div class="ability-row">
                        <span class="ability-label">ENE (ì—ë„ˆì§€)</span>
                        <input type="number" class="ability-value" id="eneStat" value="50" min="1" max="100">
                        <span class="ability-description">ì´ˆëŠ¥ë ¥/ë§ˆë²• ì—ë„ˆì§€ ì›ì²œ</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">CTL (ì œì–´)</span>
                        <input type="number" class="ability-value" id="ctlStat" value="50" min="1" max="100">
                        <span class="ability-description">ëŠ¥ë ¥ ì œì–´ ì •í™•ë„ì™€ íš¨ìœ¨ì„±</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">RNG (ë²”ìœ„)</span>
                        <input type="number" class="ability-value" id="rngStat" value="50" min="1" max="100">
                        <span class="ability-description">ëŠ¥ë ¥ì˜ ìœ íš¨ ë²”ìœ„</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">VAR (ë‹¤ì–‘ì„±)</span>
                        <input type="number" class="ability-value" id="varStat" value="50" min="1" max="100">
                        <span class="ability-description">ì‚¬ìš© ê°€ëŠ¥í•œ ëŠ¥ë ¥ì˜ ë‹¤ì–‘ì„±</span>
                    </div>
                </div>

                <div class="ability-section">
                    <h4>ì •ì‹ ì /ì „ìˆ ì  ëŠ¥ë ¥</h4>
                    <div class="ability-row">
                        <span class="ability-label">INT (ì§€ëŠ¥)</span>
                        <input type="number" class="ability-value" id="intStat" value="50" min="1" max="100">
                        <span class="ability-description">ë¬¸ì œ í•´ê²°ë ¥, ì „ìˆ ì  ì‚¬ê³ </span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">PER (ì¸ì§€)</span>
                        <input type="number" class="ability-value" id="perStat" value="50" min="1" max="100">
                        <span class="ability-description">ìƒí™© ì¸ì‹, ì•½ì  íŒŒì•…</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">WIL (ì˜ì§€)</span>
                        <input type="number" class="ability-value" id="wilStat" value="50" min="1" max="100">
                        <span class="ability-description">ì •ì‹ ë ¥, ê²°ë‹¨ë ¥</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">ADP (ì ì‘ë ¥)</span>
                        <input type="number" class="ability-value" id="adpStat" value="50" min="1" max="100">
                        <span class="ability-description">ìƒˆë¡œìš´ ìƒí™© ëŒ€ì²˜ ëŠ¥ë ¥</span>
                    </div>
                </div>

                <div class="ability-section">
                    <h4>ê¸°ìˆ  ë° ì¥ë¹„</h4>
                    <div class="form-group">
                        <label for="charSkills">ìŠ¤í‚¬ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                        <input type="text" id="charSkills" value="ë² ê¸°,ì°Œë¥´ê¸°,ë°©ì–´,íšŒë³µ">
                    </div>
                    <div class="form-group">
                        <label for="charItems">ì•„ì´í…œ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                        <input type="text" id="charItems" value="ì²´ë ¥ ë¬¼ì•½,ë§ˆë‚˜ ë¬¼ì•½,ë°©ì–´êµ¬ ê°•í™”,ë¬´ê¸° ê°•í™”">
                    </div>
                </div>

                <button class="btn" id="createCharacterBtn">ìºë¦­í„° ìƒì„±</button>
            </div>

            <div class="character-sheet" id="characterSheet">
                <h3>ìºë¦­í„° ì •ë³´</h3>
                <div id="characterInfo">
                    <div class="char-header">
                        <h4 id="selectedCharName">ì•„ë¬´ ìºë¦­í„°ë„ ì„ íƒë˜ì§€ ì•ŠìŒ</h4>
                        <span id="rankBadge" class="rank-badge"></span>
                    </div>
                    <div class="health-container">
                        <div class="stat">
                            <span>HP:</span>
                            <span id="charHP">-</span>
                        </div>
                        <div class="health-bar">
                            <div class="health-fill" id="healthFill"></div>
                        </div>
                    </div>

                    <div class="stats-container">
                        <div class="stats-group">
                            <h4>ë¬¼ë¦¬ì  ëŠ¥ë ¥</h4>
                            <div class="stats">
                                <div class="stat">
                                    <span>STR (í˜):</span>
                                    <span id="charSTR">-</span>
                                </div>
                                <div class="stat">
                                    <span>AGI (ë¯¼ì²©):</span>
                                    <span id="charAGI">-</span>
                                </div>
                                <div class="stat">
                                    <span>VIT (ì²´ë ¥):</span>
                                    <span id="charVIT">-</span>
                                </div>
                                <div class="stat">
                                    <span>TEC (ê¸°ìˆ ):</span>
                                    <span id="charTEC">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="stats-group">
                            <h4>ì´ˆìì—°ì /íŠ¹ìˆ˜ ëŠ¥ë ¥</h4>
                            <div class="stats">
                                <div class="stat">
                                    <span>ENE (ì—ë„ˆì§€):</span>
                                    <span id="charENE">-</span>
                                </div>
                                <div class="stat">
                                    <span>CTL (ì œì–´):</span>
                                    <span id="charCTL">-</span>
                                </div>
                                <div class="stat">
                                    <span>RNG (ë²”ìœ„):</span>
                                    <span id="charRNG">-</span>
                                </div>
                                <div class="stat">
                                    <span>VAR (ë‹¤ì–‘ì„±):</span>
                                    <span id="charVAR">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="stats-group">
                            <h4>ì •ì‹ ì /ì „ìˆ ì  ëŠ¥ë ¥</h4>
                            <div class="stats">
                                <div class="stat">
                                    <span>INT (ì§€ëŠ¥):</span>
                                    <span id="charINT">-</span>
                                </div>
                                <div class="stat">
                                    <span>PER (ì¸ì§€):</span>
                                    <span id="charPER">-</span>
                                </div>
                                <div class="stat">
                                    <span>WIL (ì˜ì§€):</span>
                                    <span id="charWIL">-</span>
                                </div>
                                <div class="stat">
                                    <span>ADP (ì ì‘ë ¥):</span>
                                    <span id="charADP">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-panel">
                <h3>í–‰ë™</h3>
                <div class="btn-group">
                    <button class="btn" id="attackBtn" disabled>ê³µê²©</button>
                    <button class="btn" id="moveBtn" disabled>ì´ë™</button>
                    <button class="btn" id="skillBtn" disabled>ìŠ¤í‚¬</button>
                    <button class="btn" id="itemBtn" disabled>ì•„ì´í…œ</button>
                    <button class="btn" id="endTurnBtn" disabled>í„´ ì¢…ë£Œ</button>
                </div>
                <div class="keyboard-controls">
                    <strong>í‚¤ë³´ë“œ ì¡°ì‘:</strong>
                    <ul>
                        <li><span class="key">â†‘</span><span class="key">â†“</span><span class="key">â†</span><span class="key">â†’</span> - ìºë¦­í„° ì´ë™</li>
                        <li><span class="key">A</span> - ê³µê²© ëª¨ë“œ</li>
                        <li><span class="key">S</span> - ìŠ¤í‚¬ ì‚¬ìš©</li>
                        <li><span class="key">I</span> - ì•„ì´í…œ ì‚¬ìš©</li>
                        <li><span class="key">E</span> - í„´ ì¢…ë£Œ</li>
                    </ul>
                </div>
            </div>

            <div class="terrain-tools">
                <h3>ì§€í˜• ë„êµ¬</h3>
                <div class="btn-group">
                    <button class="btn btn-terrain" id="normalTerrain" title="ì¼ë°˜ ì§€í˜•">ğŸŸ«</button>
                    <button class="btn btn-terrain" id="wallTerrain" title="ë²½">â¬›</button>
                    <button class="btn btn-terrain" id="waterTerrain" title="ë¬¼">ğŸŸ¦</button>
                    <button class="btn btn-terrain" id="highGroundTerrain" title="ë†’ì€ ì§€í˜•">ğŸŸ§</button>
                    <button class="btn" id="resetGrid">ì§€í˜• ì´ˆê¸°í™”</button>
                </div>
            </div>

            <div class="log-panel">
                <h3>ì „íˆ¬ ë¡œê·¸</h3>
                <div class="log-content" id="battleLog">
                    <div class="log-entry log-system">ìºë¦­í„°ë¥¼ ìƒì„±í•˜ê³  ì „íˆ¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìŠ¤í‚¬ ì„ íƒ ëª©ë¡ -->
    <div id="skillList"></div>
    <!-- ì•„ì´í…œ ì„ íƒ ëª©ë¡ -->
    <div id="itemList"></div>

    <script>
        // ê²Œì„ ìƒíƒœ ê´€ë¦¬
        const gameState = {
            characters: [],
            selectedCharacter: null,
            selectedTerrain: 'normal',
            currentTurn: 'none', // 'player' ë˜ëŠ” 'enemy'
            activeTurnCharacter: null,
            turnNumber: 0,
            actionCounts: {
                move: 0,
                attack: 0,
                skill: 0,
                item: 0
            },
            battleLog: [],
            currentMode: null, // 'attack', 'move', 'skill', 'item'
            rangeHighlights: []
        };

        // ìºë¦­í„° í´ë˜ìŠ¤
        class Character {
            constructor(name, type, x, y, stats, skills, items) {
                this.id = Date.now() + Math.floor(Math.random() * 1000);
                this.name = name;
                this.type = type; // 'player' ë˜ëŠ” 'enemy'
                this.x = x;
                this.y = y;
                
                // ë‹¤ì°¨ì› ì „íˆ¬ë ¥ í‰ê°€ ì‹œìŠ¤í…œ ëŠ¥ë ¥ì¹˜
                this.stats = stats || {
                    // ë¬¼ë¦¬ì  ëŠ¥ë ¥
                    strength: 50,
                    agility: 50,
                    vitality: 50,
                    technique: 50,
                    // ì´ˆìì—°/íŠ¹ìˆ˜ ëŠ¥ë ¥
                    energy: 50,
                    control: 50,
                    range: 50,
                    variety: 50,
                    // ì •ì‹ /ì „ìˆ  ëŠ¥ë ¥
                    intelligence: 50,
                    perception: 50,
                    willpower: 50,
                    adaptability: 50
                };

                // ì „íˆ¬ë ¥ ë­í¬ ê³„ì‚°
                this.calculateRank();
                
                // ì²´ë ¥ ê³„ì‚° (ì²´ë ¥ ëŠ¥ë ¥ì¹˜ì— ë”°ë¼)
                this.maxHp = 50 + this.stats.vitality * 2;
                this.hp = this.maxHp;
                
                // ì´ë™ ë²”ìœ„ (ë¯¼ì²©ì„±ì— ë”°ë¼)
                this.moveRange = Math.max(1, Math.floor(this.stats.agility / 20));
                
                // ê³µê²© ë²”ìœ„ (ë²”ìœ„ ëŠ¥ë ¥ì¹˜ì— ë”°ë¼)
                this.attackRange = Math.max(1, Math.floor(this.stats.range / 20));
                
                // ìŠ¤í‚¬ê³¼ ì•„ì´í…œ
                this.skills = skills || ["ë² ê¸°", "ì°Œë¥´ê¸°", "ë°©ì–´", "íšŒë³µ"];
                this.items = items || ["ì²´ë ¥ ë¬¼ì•½", "ë§ˆë‚˜ ë¬¼ì•½", "ë°©ì–´êµ¬ ê°•í™”", "ë¬´ê¸° ê°•í™”"];
                
                // ì‚¬ìš©í•œ ìŠ¤í‚¬/ì•„ì´í…œ ì¹´ìš´íŠ¸
                this.usedSkills = {};
                this.usedItems = {};
            }

            calculateRank() {
                // ëª¨ë“  ëŠ¥ë ¥ì¹˜ì˜ í‰ê·  ê³„ì‚°
                const statValues = Object.values(this.stats);
                const average = statValues.reduce((sum, value) => sum + value, 0) / statValues.length;
                
                // ë­í¬ ê²°ì •
                if (average >= 95) this.rank = "S+";
                else if (average >= 85) this.rank = "S";
                else if (average >= 75) this.rank = "A+";
                else if (average >= 65) this.rank = "A";
                else if (average >= 55) this.rank = "B+";
                else if (average >= 45) this.rank = "B";
                else if (average >= 35) this.rank = "C+";
                else if (average >= 25) this.rank = "C";
                else if (average >= 15) this.rank = "D";
                else if (average >= 5) this.rank = "E";
                else this.rank = "F";
                
                this.combatPower = Math.round(average);
                return this.rank;
            }

            attack(target) {
                // ê³µê²© ì„±ê³µ ê³„ì‚° (ê³µê²©ìì˜ ê¸°ìˆ  vs ë°©ì–´ìì˜ ë¯¼ì²©)
                const attackValue = this.stats.technique + (this.stats.strength / 2);
                const defenseValue = target.stats.agility;
                
                // ì„±ê³µ í™•ë¥  ê³„ì‚° (í¼ì„¼íŠ¸)
                let successChance = 50 + ((attackValue - defenseValue) / 2);
                successChance = Math.min(95, Math.max(5, successChance)); // 5%~95% ë²”ìœ„ë¡œ ì œí•œ
                
                // ì‹¤ì œ íŒì •
                const roll = Math.random() * 100;
                const isSuccess = roll <= successChance;
                
                // ë¡œê·¸ ë©”ì‹œì§€
                const attackMessage = `${this.name}ì´(ê°€) ${target.name}ì—ê²Œ ê³µê²©ì„ ì‹œë„í•©ë‹ˆë‹¤. (ì„±ê³µ í™•ë¥ : ${Math.round(successChance)}%)`;
                addLogEntry(attackMessage, this.type);
                
                if (isSuccess) {
                    // ê³µê²© ì„±ê³µ
                    // ë°ë¯¸ì§€ ê³„ì‚° (í˜ + ê¸°ìˆ  ê¸°ë°˜)
                    const baseDamage = this.stats.strength * 0.8;
                    const techBonus = this.stats.technique * 0.4;
                    const damage = Math.max(1, Math.round(baseDamage + techBonus));
                    
                    // ë°©ì–´ ê³„ì‚° (ì²´ë ¥ ê¸°ë°˜)
                    const defense = Math.round(target.stats.vitality * 0.3);
                    const finalDamage = Math.max(1, damage - defense);
                    
                    // ë°ë¯¸ì§€ ì ìš©
                    target.hp = Math.max(0, target.hp - finalDamage);
                    
                    const damageMessage = `${this.name}ì´(ê°€) ${target.name}ì—ê²Œ ${finalDamage}ì˜ í”¼í•´ë¥¼ ì…í˜”ìŠµë‹ˆë‹¤! (${target.name} HP: ${target.hp}/${target.maxHp})`;
                    addLogEntry(damageMessage, this.type);
                    
                    if (target.hp <= 0) {
                        const defeatMessage = `${target.name}ì´(ê°€) ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤!`;
                        addLogEntry(defeatMessage, 'system');
                    }
                    return true;
                } else {
                    // ê³µê²© ì‹¤íŒ¨
                    const missMessage = `${this.name}ì˜ ê³µê²©ì´ ë¹—ë‚˜ê°”ìŠµë‹ˆë‹¤!`;
                    addLogEntry(missMessage, this.type);
                    return false;
                }
            }

            // ìŠ¤í‚¬ ì‚¬ìš©
            useSkill(skillName, target) {
                const skillEffects = {
                    "ë² ê¸°": {
                        damage: this.stats.strength * 1.2,
                        message: `${this.name}ì´(ê°€) ${target.name}ì—ê²Œ ê°•ë ¥í•œ ë² ê¸° ê³µê²©ì„ ê°€í–ˆìŠµë‹ˆë‹¤!`
                    },
                    "ì°Œë¥´ê¸°": {
                        damage: this.stats.technique * 1.5,
                        message: `${this.name}ì´(ê°€) ${target.name}ì˜ ì•½ì ì„ ì •í™•íˆ ì°Œë¦…ë‹ˆë‹¤!`
                    },
                    "ë°©ì–´": {
                        selfBuff: "defense",
                        buffAmount: this.stats.vitality * 0.5,
                        message: `${this.name}ì´(ê°€) ë°©ì–´ íƒœì„¸ë¥¼ ì·¨í•©ë‹ˆë‹¤. ë‹¤ìŒ ê³µê²©ì— ëŒ€í•œ ë°©ì–´ë ¥ì´ ì¦ê°€í•©ë‹ˆë‹¤.`
                    },
                    "íšŒë³µ": {
                        heal: this.stats.energy * 0.8,
                        message: `${this.name}ì´(ê°€) ìì‹ ì˜ ìƒì²˜ë¥¼ ì¹˜ë£Œí•©ë‹ˆë‹¤.`
                    }
                };
                
                // ê¸°ë³¸ ìŠ¤í‚¬ì´ ì•„ë‹Œ ê²½ìš° ì„ì˜ì˜ íš¨ê³¼ ìƒì„±
                if (!skillEffects[skillName]) {
                    skillEffects[skillName] = {
                        damage: this.stats.energy * 1.0,
                        message: `${this.name}ì´(ê°€) ${skillName} ìŠ¤í‚¬ì„ ì‚¬ìš©í•©ë‹ˆë‹¤!`
                    };
                }
                
                const effect = skillEffects[skillName];
                addLogEntry(effect.message, this.type);
                
                // ë°ë¯¸ì§€ íš¨ê³¼
                if (effect.damage && target) {
                    const damage = Math.round(effect.damage);
                    target.hp = Math.max(0, target.hp - damage);
                    addLogEntry(`${target.name}ì—ê²Œ ${damage}ì˜ í”¼í•´ë¥¼ ì…í˜”ìŠµë‹ˆë‹¤! (${target.name} HP: ${target.hp}/${target.maxHp})`, this.type);
                    
                    if (target.hp <= 0) {
                        addLogEntry(`${target.name}ì´(ê°€) ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤!`, 'system');
                    }
                }
                
                // íšŒë³µ íš¨ê³¼
                if (effect.heal) {
                    const healAmount = Math.round(effect.heal);
                    const oldHp = this.hp;
                    this.hp = Math.min(this.maxHp, this.hp + healAmount);
                    const actualHeal = this.hp - oldHp;
                    addLogEntry(`${this.name}ì´(ê°€) ${actualHeal}ì˜ ì²´ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤! (HP: ${this.hp}/${this.maxHp})`, this.type);
                }
                
                // ë²„í”„ íš¨ê³¼
                if (effect.selfBuff) {
                    addLogEntry(`${this.name}ì—ê²Œ ${effect.selfBuff} íš¨ê³¼ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`, this.type);
                }
                
                return true;
            }
            
            // ì•„ì´í…œ ì‚¬ìš©
            useItem(itemName, target) {
                const itemEffects = {
                    "ì²´ë ¥ ë¬¼ì•½": {
                        heal: this.maxHp * 0.3,
                        message: `${this.name}ì´(ê°€) ì²´ë ¥ ë¬¼ì•½ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.`
                    },
                    "ë§ˆë‚˜ ë¬¼ì•½": {
                        energyRestore: this.stats.energy * 0.5,
                        message: `${this.name}ì´(ê°€) ë§ˆë‚˜ ë¬¼ì•½ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.`
                    },
                    "ë°©ì–´êµ¬ ê°•í™”": {
                        defenseBuff: this.stats.vitality * 0.2,
                        duration: 3,
                        message: `${this.name}ì´(ê°€) ë°©ì–´êµ¬ë¥¼ ê°•í™”í–ˆìŠµë‹ˆë‹¤.`
                    },
                    "ë¬´ê¸° ê°•í™”": {
                        attackBuff: this.stats.strength * 0.2,
                        duration: 3,
                        message: `${this.name}ì´(ê°€) ë¬´ê¸°ë¥¼ ê°•í™”í–ˆìŠµë‹ˆë‹¤.`
                    }
                };
                
                // ê¸°ë³¸ ì•„ì´í…œì´ ì•„ë‹Œ ê²½ìš° ì„ì˜ì˜ íš¨ê³¼ ìƒì„±
                if (!itemEffects[itemName]) {
                    itemEffects[itemName] = {
                        heal: this.maxHp * 0.2,
                        message: `${this.name}ì´(ê°€) ${itemName}ì„(ë¥¼) ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.`
                    };
                }
                
                const effect = itemEffects[itemName];
                addLogEntry(effect.message, this.type);
                
                // íšŒë³µ íš¨ê³¼
                if (effect.heal) {
                    const healAmount = Math.round(effect.heal);
                    const oldHp = this.hp;
                    this.hp = Math.min(this.maxHp, this.hp + healAmount);
                    const actualHeal = this.hp - oldHp;
                    addLogEntry(`${this.name}ì´(ê°€) ${actualHeal}ì˜ ì²´ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤! (HP: ${this.hp}/${this.maxHp})`, this.type);
                }
                
                // ì—ë„ˆì§€ íšŒë³µ íš¨ê³¼
                if (effect.energyRestore) {
                    addLogEntry(`${this.name}ì´(ê°€) ì—ë„ˆì§€ë¥¼ íšŒë³µí–ˆìŠµë‹ˆë‹¤.`, this.type);
                }
                
                // ë²„í”„ íš¨ê³¼
                if (effect.defenseBuff) {
                    addLogEntry(`${this.name}ì˜ ë°©ì–´ë ¥ì´ ${effect.duration}í„´ ë™ì•ˆ ì¦ê°€í•©ë‹ˆë‹¤.`, this.type);
                }
                
                if (effect.attackBuff) {
                    addLogEntry(`${this.name}ì˜ ê³µê²©ë ¥ì´ ${effect.duration}í„´ ë™ì•ˆ ì¦ê°€í•©ë‹ˆë‹¤.`, this.type);
                }
                
                return true;
            }
        }
