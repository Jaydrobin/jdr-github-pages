<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>다차원 전투력 평가 시스템 RPG 전투</title>
    <style>
        :root {
            --primary-color: #422800;
            --secondary-color: #a98467;
            --accent-color: #bc6c25;
            --background-color: #ede0d4;
            --grid-color: #ddbea9;
            --player-color: #0077b6;
            --enemy-color: #d62828;
            --highlight-color: #ffb703;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--primary-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        .game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .battle-grid {
            flex: 2;
            min-width: 600px;
            height: 600px;
            background-color: #5a3921;
            border: 2px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="50" height="50" x="0" y="0" fill="%23654321" /><rect width="50" height="50" x="50" y="50" fill="%23654321" /><rect width="50" height="50" x="50" y="0" fill="%23765432" /><rect width="50" height="50" x="0" y="50" fill="%23765432" /></svg>');
            background-size: 60px 60px;
        }

        .cell {
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .cell:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .cell.highlight {
            background-color: rgba(255, 215, 0, 0.3);
        }

        .wall {
            background-color: #2f2f2f;
        }

        .water {
            background-color: #4a80bd;
        }

        .high-ground {
            background-color: #8d6e63;
        }

        .character {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .character.active {
            box-shadow: 0 0 10px 5px var(--highlight-color);
        }

        .player {
            background-color: var(--player-color);
            color: white;
            border: 2px solid #004c8c;
        }

        .enemy {
            background-color: var(--enemy-color);
            color: white;
            border: 2px solid #9e0000;
        }

        .ui-panel {
            flex: 1;
            min-width: 350px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .character-sheet, .action-panel, .log-panel, .terrain-tools, .create-character, .turn-info {
            background-color: #f5f5f5;
            border: 1px solid var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .character-sheet h3, .action-panel h3, .log-panel h3, .terrain-tools h3, .create-character h3, .turn-info h3 {
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 8px;
            margin-bottom: 10px;
        }

        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stats-group {
            margin-bottom: 10px;
        }

        .stats-group h4 {
            margin-bottom: 5px;
            color: var(--accent-color);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat {
            display: flex;
            justify-content: space-between;
        }

        .stat-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 3px;
            position: relative;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px 0;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: #a85c21;
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .btn-terrain {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            font-size: 20px;
        }

        .log-content {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 8px;
            background-color: #fff;
            font-size: 14px;
        }

        .log-entry {
            margin-bottom: 4px;
            padding-bottom: 4px;
            border-bottom: 1px solid #eee;
        }

        .log-player {
            color: var(--player-color);
        }

        .log-enemy {
            color: var(--enemy-color);
        }

        .log-system {
            color: #555;
            font-style: italic;
        }

        .log-turn {
            color: var(--highlight-color);
            font-weight: bold;
        }

        .health-bar {
            height: 15px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            background-color: #e63946;
            width: 100%;
            transition: width 0.3s ease;
        }

        .create-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .form-group {
            margin-bottom: 8px;
        }

        .form-group label {
            display: block;
            margin-bottom: 3px;
            font-weight: bold;
            font-size: 12px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .form-group input[type="number"] {
            width: 60px;
        }

        .ability-section {
            margin-top: 10px;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }

        .ability-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .ability-label {
            width: 100px;
            font-weight: bold;
            font-size: 12px;
        }

        .ability-value {
            width: 60px;
        }

        .ability-description {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
        }

        .turn-info {
            background-color: #f8f9fa;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            padding: 10px;
        }

        .turn-player {
            color: var(--player-color);
        }

        .turn-enemy {
            color: var(--enemy-color);
        }

        .action-counters {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            background-color: #f0f0f0;
            padding: 8px;
            border-radius: 4px;
        }

        .counter-item {
            text-align: center;
        }

        .counter-value {
            font-weight: bold;
            font-size: 20px;
        }

        .counter-label {
            font-size: 12px;
            color: #666;
        }

        .rank-badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: white;
            margin-left: 10px;
        }

        .rank-S-plus { background-color: #9d4edd; }
        .rank-S { background-color: #7b2cbf; }
        .rank-A-plus { background-color: #5a189a; }
        .rank-A { background-color: #3c096c; }
        .rank-B-plus { background-color: #240046; }
        .rank-B { background-color: #10002b; }
        .rank-C-plus { background-color: #3a5a40; }
        .rank-C { background-color: #344e41; }
        .rank-D { background-color: #6c757d; }
        .rank-E { background-color: #adb5bd; }
        .rank-F { background-color: #ced4da; }

        .attack-range {
            background-color: rgba(255, 0, 0, 0.2);
        }

        .move-range {
            background-color: rgba(0, 255, 0, 0.2);
        }

        #skillList, #itemList {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .skill-item, .item-item {
            padding: 5px 10px;
            margin-bottom: 5px;
            cursor: pointer;
            border-radius: 4px;
        }

        .skill-item:hover, .item-item:hover {
            background-color: #f0f0f0;
        }

        .keyboard-controls {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            font-size: 14px;
        }

        .keyboard-controls ul {
            list-style-type: none;
            padding-left: 15px;
        }

        .key {
            display: inline-block;
            padding: 2px 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            border: 1px solid #ccc;
            font-family: monospace;
            margin: 0 3px;
        }

        @media (max-width: 950px) {
            .game-container {
                flex-direction: column;
            }
            .battle-grid {
                min-width: 100%;
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>다차원 전투력 평가 시스템 RPG 전투</h1>
        <p>방향키로 캐릭터를 이동시키고, 턴제 전투 시스템으로 전투를 진행하세요.</p>
    </header>

    <div class="game-container">
        <div class="battle-grid">
            <div class="grid" id="battleGrid"></div>
        </div>

        <div class="ui-panel">
            <div class="turn-info" id="turnInfo">
                <div id="currentTurn">게임 시작 전</div>
                <div class="action-counters" id="actionCounters" style="display: none;">
                    <div class="counter-item">
                        <div class="counter-value" id="moveCounter">0/1</div>
                        <div class="counter-label">이동</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-value" id="attackCounter">0/1</div>
                        <div class="counter-label">공격</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-value" id="skillCounter">0/1</div>
                        <div class="counter-label">스킬</div>
                    </div>
                    <div class="counter-item">
                        <div class="counter-value" id="itemCounter">0/1</div>
                        <div class="counter-label">아이템</div>
                    </div>
                </div>
            </div>

            <div class="create-character" id="createCharacterPanel">
                <h3>캐릭터 생성</h3>
                <div class="create-form">
                    <div class="form-group">
                        <label for="charName">이름</label>
                        <input type="text" id="charName" value="용사">
                    </div>
                    <div class="form-group">
                        <label for="charType">유형</label>
                        <select id="charType">
                            <option value="player">플레이어</option>
                            <option value="enemy">적</option>
                        </select>
                    </div>
                </div>

                <div class="ability-section">
                    <h4>물리적 능력</h4>
                    <div class="ability-row">
                        <span class="ability-label">STR (힘)</span>
                        <input type="number" class="ability-value" id="strStat" value="50" min="1" max="100">
                        <span class="ability-description">물리적 힘, 타격력, 무기 다루기</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">AGI (민첩)</span>
                        <input type="number" class="ability-value" id="agiStat" value="50" min="1" max="100">
                        <span class="ability-description">속도, 반응 시간, 회피 능력</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">VIT (체력)</span>
                        <input type="number" class="ability-value" id="vitStat" value="50" min="1" max="100">
                        <span class="ability-description">내구성, 상처 회복, 피로 저항</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">TEC (기술)</span>
                        <input type="number" class="ability-value" id="tecStat" value="50" min="1" max="100">
                        <span class="ability-description">전투 기술, 무기 숙련도, 정확도</span>
                    </div>
                </div>

                <div class="ability-section">
                    <h4>초자연적/특수 능력</h4>
                    <div class="ability-row">
                        <span class="ability-label">ENE (에너지)</span>
                        <input type="number" class="ability-value" id="eneStat" value="50" min="1" max="100">
                        <span class="ability-description">초능력/마법 에너지 원천</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">CTL (제어)</span>
                        <input type="number" class="ability-value" id="ctlStat" value="50" min="1" max="100">
                        <span class="ability-description">능력 제어 정확도와 효율성</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">RNG (범위)</span>
                        <input type="number" class="ability-value" id="rngStat" value="50" min="1" max="100">
                        <span class="ability-description">능력의 유효 범위</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">VAR (다양성)</span>
                        <input type="number" class="ability-value" id="varStat" value="50" min="1" max="100">
                        <span class="ability-description">사용 가능한 능력의 다양성</span>
                    </div>
                </div>

                <div class="ability-section">
                    <h4>정신적/전술적 능력</h4>
                    <div class="ability-row">
                        <span class="ability-label">INT (지능)</span>
                        <input type="number" class="ability-value" id="intStat" value="50" min="1" max="100">
                        <span class="ability-description">문제 해결력, 전술적 사고</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">PER (인지)</span>
                        <input type="number" class="ability-value" id="perStat" value="50" min="1" max="100">
                        <span class="ability-description">상황 인식, 약점 파악</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">WIL (의지)</span>
                        <input type="number" class="ability-value" id="wilStat" value="50" min="1" max="100">
                        <span class="ability-description">정신력, 결단력</span>
                    </div>
                    <div class="ability-row">
                        <span class="ability-label">ADP (적응력)</span>
                        <input type="number" class="ability-value" id="adpStat" value="50" min="1" max="100">
                        <span class="ability-description">새로운 상황 대처 능력</span>
                    </div>
                </div>

                <div class="ability-section">
                    <h4>기술 및 장비</h4>
                    <div class="form-group">
                        <label for="charSkills">스킬 (쉼표로 구분)</label>
                        <input type="text" id="charSkills" value="베기,찌르기,방어,회복">
                    </div>
                    <div class="form-group">
                        <label for="charItems">아이템 (쉼표로 구분)</label>
                        <input type="text" id="charItems" value="체력 물약,마나 물약,방어구 강화,무기 강화">
                    </div>
                </div>

                <button class="btn" id="createCharacterBtn">캐릭터 생성</button>
            </div>

            <div class="character-sheet" id="characterSheet">
                <h3>캐릭터 정보</h3>
                <div id="characterInfo">
                    <div class="char-header">
                        <h4 id="selectedCharName">아무 캐릭터도 선택되지 않음</h4>
                        <span id="rankBadge" class="rank-badge"></span>
                    </div>
                    <div class="health-container">
                        <div class="stat">
                            <span>HP:</span>
                            <span id="charHP">-</span>
                        </div>
                        <div class="health-bar">
                            <div class="health-fill" id="healthFill"></div>
                        </div>
                    </div>

                    <div class="stats-container">
                        <div class="stats-group">
                            <h4>물리적 능력</h4>
                            <div class="stats">
                                <div class="stat">
                                    <span>STR (힘):</span>
                                    <span id="charSTR">-</span>
                                </div>
                                <div class="stat">
                                    <span>AGI (민첩):</span>
                                    <span id="charAGI">-</span>
                                </div>
                                <div class="stat">
                                    <span>VIT (체력):</span>
                                    <span id="charVIT">-</span>
                                </div>
                                <div class="stat">
                                    <span>TEC (기술):</span>
                                    <span id="charTEC">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="stats-group">
                            <h4>초자연적/특수 능력</h4>
                            <div class="stats">
                                <div class="stat">
                                    <span>ENE (에너지):</span>
                                    <span id="charENE">-</span>
                                </div>
                                <div class="stat">
                                    <span>CTL (제어):</span>
                                    <span id="charCTL">-</span>
                                </div>
                                <div class="stat">
                                    <span>RNG (범위):</span>
                                    <span id="charRNG">-</span>
                                </div>
                                <div class="stat">
                                    <span>VAR (다양성):</span>
                                    <span id="charVAR">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="stats-group">
                            <h4>정신적/전술적 능력</h4>
                            <div class="stats">
                                <div class="stat">
                                    <span>INT (지능):</span>
                                    <span id="charINT">-</span>
                                </div>
                                <div class="stat">
                                    <span>PER (인지):</span>
                                    <span id="charPER">-</span>
                                </div>
                                <div class="stat">
                                    <span>WIL (의지):</span>
                                    <span id="charWIL">-</span>
                                </div>
                                <div class="stat">
                                    <span>ADP (적응력):</span>
                                    <span id="charADP">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-panel">
                <h3>행동</h3>
                <div class="btn-group">
                    <button class="btn" id="attackBtn" disabled>공격</button>
                    <button class="btn" id="moveBtn" disabled>이동</button>
                    <button class="btn" id="skillBtn" disabled>스킬</button>
                    <button class="btn" id="itemBtn" disabled>아이템</button>
                    <button class="btn" id="endTurnBtn" disabled>턴 종료</button>
                </div>
                <div class="keyboard-controls">
                    <strong>키보드 조작:</strong>
                    <ul>
                        <li><span class="key">↑</span><span class="key">↓</span><span class="key">←</span><span class="key">→</span> - 캐릭터 이동</li>
                        <li><span class="key">A</span> - 공격 모드</li>
                        <li><span class="key">S</span> - 스킬 사용</li>
                        <li><span class="key">I</span> - 아이템 사용</li>
                        <li><span class="key">E</span> - 턴 종료</li>
                    </ul>
                </div>
            </div>

            <div class="terrain-tools">
                <h3>지형 도구</h3>
                <div class="btn-group">
                    <button class="btn btn-terrain" id="normalTerrain" title="일반 지형">🟫</button>
                    <button class="btn btn-terrain" id="wallTerrain" title="벽">⬛</button>
                    <button class="btn btn-terrain" id="waterTerrain" title="물">🟦</button>
                    <button class="btn btn-terrain" id="highGroundTerrain" title="높은 지형">🟧</button>
                    <button class="btn" id="resetGrid">지형 초기화</button>
                </div>
            </div>

            <div class="log-panel">
                <h3>전투 로그</h3>
                <div class="log-content" id="battleLog">
                    <div class="log-entry log-system">캐릭터를 생성하고 전투를 시작하세요.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 스킬 선택 목록 -->
    <div id="skillList"></div>
    <!-- 아이템 선택 목록 -->
    <div id="itemList"></div>

    <script>
        // 게임 상태 관리
        const gameState = {
            characters: [],
            selectedCharacter: null,
            selectedTerrain: 'normal',
            currentTurn: 'none', // 'player' 또는 'enemy'
            activeTurnCharacter: null,
            turnNumber: 0,
            actionCounts: {
                move: 0,
                attack: 0,
                skill: 0,
                item: 0
            },
            battleLog: [],
            currentMode: null, // 'attack', 'move', 'skill', 'item'
            rangeHighlights: []
        };

        // 캐릭터 클래스
        class Character {
            constructor(name, type, x, y, stats, skills, items) {
                this.id = Date.now() + Math.floor(Math.random() * 1000);
                this.name = name;
                this.type = type; // 'player' 또는 'enemy'
                this.x = x;
                this.y = y;
                
                // 다차원 전투력 평가 시스템 능력치
                this.stats = stats || {
                    // 물리적 능력
                    strength: 50,
                    agility: 50,
                    vitality: 50,
                    technique: 50,
                    // 초자연/특수 능력
                    energy: 50,
                    control: 50,
                    range: 50,
                    variety: 50,
                    // 정신/전술 능력
                    intelligence: 50,
                    perception: 50,
                    willpower: 50,
                    adaptability: 50
                };

                // 전투력 랭크 계산
                this.calculateRank();
                
                // 체력 계산 (체력 능력치에 따라)
                this.maxHp = 50 + this.stats.vitality * 2;
                this.hp = this.maxHp;
                
                // 이동 범위 (민첩성에 따라)
                this.moveRange = Math.max(1, Math.floor(this.stats.agility / 20));
                
                // 공격 범위 (범위 능력치에 따라)
                this.attackRange = Math.max(1, Math.floor(this.stats.range / 20));
                
                // 스킬과 아이템
                this.skills = skills || ["베기", "찌르기", "방어", "회복"];
                this.items = items || ["체력 물약", "마나 물약", "방어구 강화", "무기 강화"];
                
                // 사용한 스킬/아이템 카운트
                this.usedSkills = {};
                this.usedItems = {};
            }

            calculateRank() {
                // 모든 능력치의 평균 계산
                const statValues = Object.values(this.stats);
                const average = statValues.reduce((sum, value) => sum + value, 0) / statValues.length;
                
                // 랭크 결정
                if (average >= 95) this.rank = "S+";
                else if (average >= 85) this.rank = "S";
                else if (average >= 75) this.rank = "A+";
                else if (average >= 65) this.rank = "A";
                else if (average >= 55) this.rank = "B+";
                else if (average >= 45) this.rank = "B";
                else if (average >= 35) this.rank = "C+";
                else if (average >= 25) this.rank = "C";
                else if (average >= 15) this.rank = "D";
                else if (average >= 5) this.rank = "E";
                else this.rank = "F";
                
                this.combatPower = Math.round(average);
                return this.rank;
            }

            attack(target) {
                // 공격 성공 계산 (공격자의 기술 vs 방어자의 민첩)
                const attackValue = this.stats.technique + (this.stats.strength / 2);
                const defenseValue = target.stats.agility;
                
                // 성공 확률 계산 (퍼센트)
                let successChance = 50 + ((attackValue - defenseValue) / 2);
                successChance = Math.min(95, Math.max(5, successChance)); // 5%~95% 범위로 제한
                
                // 실제 판정
                const roll = Math.random() * 100;
                const isSuccess = roll <= successChance;
                
                // 로그 메시지
                const attackMessage = `${this.name}이(가) ${target.name}에게 공격을 시도합니다. (성공 확률: ${Math.round(successChance)}%)`;
                addLogEntry(attackMessage, this.type);
                
                if (isSuccess) {
                    // 공격 성공
                    // 데미지 계산 (힘 + 기술 기반)
                    const baseDamage = this.stats.strength * 0.8;
                    const techBonus = this.stats.technique * 0.4;
                    const damage = Math.max(1, Math.round(baseDamage + techBonus));
                    
                    // 방어 계산 (체력 기반)
                    const defense = Math.round(target.stats.vitality * 0.3);
                    const finalDamage = Math.max(1, damage - defense);
                    
                    // 데미지 적용
                    target.hp = Math.max(0, target.hp - finalDamage);
                    
                    const damageMessage = `${this.name}이(가) ${target.name}에게 ${finalDamage}의 피해를 입혔습니다! (${target.name} HP: ${target.hp}/${target.maxHp})`;
                    addLogEntry(damageMessage, this.type);
                    
                    if (target.hp <= 0) {
                        const defeatMessage = `${target.name}이(가) 쓰러졌습니다!`;
                        addLogEntry(defeatMessage, 'system');
                    }
                    return true;
                } else {
                    // 공격 실패
                    const missMessage = `${this.name}의 공격이 빗나갔습니다!`;
                    addLogEntry(missMessage, this.type);
                    return false;
                }
            }

            // 스킬 사용
            useSkill(skillName, target) {
                const skillEffects = {
                    "베기": {
                        damage: this.stats.strength * 1.2,
                        message: `${this.name}이(가) ${target.name}에게 강력한 베기 공격을 가했습니다!`
                    },
                    "찌르기": {
                        damage: this.stats.technique * 1.5,
                        message: `${this.name}이(가) ${target.name}의 약점을 정확히 찌릅니다!`
                    },
                    "방어": {
                        selfBuff: "defense",
                        buffAmount: this.stats.vitality * 0.5,
                        message: `${this.name}이(가) 방어 태세를 취합니다. 다음 공격에 대한 방어력이 증가합니다.`
                    },
                    "회복": {
                        heal: this.stats.energy * 0.8,
                        message: `${this.name}이(가) 자신의 상처를 치료합니다.`
                    }
                };
                
                // 기본 스킬이 아닌 경우 임의의 효과 생성
                if (!skillEffects[skillName]) {
                    skillEffects[skillName] = {
                        damage: this.stats.energy * 1.0,
                        message: `${this.name}이(가) ${skillName} 스킬을 사용합니다!`
                    };
                }
                
                const effect = skillEffects[skillName];
                addLogEntry(effect.message, this.type);
                
                // 데미지 효과
                if (effect.damage && target) {
                    const damage = Math.round(effect.damage);
                    target.hp = Math.max(0, target.hp - damage);
                    addLogEntry(`${target.name}에게 ${damage}의 피해를 입혔습니다! (${target.name} HP: ${target.hp}/${target.maxHp})`, this.type);
                    
                    if (target.hp <= 0) {
                        addLogEntry(`${target.name}이(가) 쓰러졌습니다!`, 'system');
                    }
                }
                
                // 회복 효과
                if (effect.heal) {
                    const healAmount = Math.round(effect.heal);
                    const oldHp = this.hp;
                    this.hp = Math.min(this.maxHp, this.hp + healAmount);
                    const actualHeal = this.hp - oldHp;
                    addLogEntry(`${this.name}이(가) ${actualHeal}의 체력을 회복했습니다! (HP: ${this.hp}/${this.maxHp})`, this.type);
                }
                
                // 버프 효과
                if (effect.selfBuff) {
                    addLogEntry(`${this.name}에게 ${effect.selfBuff} 효과가 적용되었습니다.`, this.type);
                }
                
                return true;
            }
            
            // 아이템 사용
            useItem(itemName, target) {
                const itemEffects = {
                    "체력 물약": {
                        heal: this.maxHp * 0.3,
                        message: `${this.name}이(가) 체력 물약을 사용했습니다.`
                    },
                    "마나 물약": {
                        energyRestore: this.stats.energy * 0.5,
                        message: `${this.name}이(가) 마나 물약을 사용했습니다.`
                    },
                    "방어구 강화": {
                        defenseBuff: this.stats.vitality * 0.2,
                        duration: 3,
                        message: `${this.name}이(가) 방어구를 강화했습니다.`
                    },
                    "무기 강화": {
                        attackBuff: this.stats.strength * 0.2,
                        duration: 3,
                        message: `${this.name}이(가) 무기를 강화했습니다.`
                    }
                };
                
                // 기본 아이템이 아닌 경우 임의의 효과 생성
                if (!itemEffects[itemName]) {
                    itemEffects[itemName] = {
                        heal: this.maxHp * 0.2,
                        message: `${this.name}이(가) ${itemName}을(를) 사용했습니다.`
                    };
                }
                
                const effect = itemEffects[itemName];
                addLogEntry(effect.message, this.type);
                
                // 회복 효과
                if (effect.heal) {
                    const healAmount = Math.round(effect.heal);
                    const oldHp = this.hp;
                    this.hp = Math.min(this.maxHp, this.hp + healAmount);
                    const actualHeal = this.hp - oldHp;
                    addLogEntry(`${this.name}이(가) ${actualHeal}의 체력을 회복했습니다! (HP: ${this.hp}/${this.maxHp})`, this.type);
                }
                
                // 에너지 회복 효과
                if (effect.energyRestore) {
                    addLogEntry(`${this.name}이(가) 에너지를 회복했습니다.`, this.type);
                }
                
                // 버프 효과
                if (effect.defenseBuff) {
                    addLogEntry(`${this.name}의 방어력이 ${effect.duration}턴 동안 증가합니다.`, this.type);
                }
                
                if (effect.attackBuff) {
                    addLogEntry(`${this.name}의 공격력이 ${effect.duration}턴 동안 증가합니다.`, this.type);
                }
                
                return true;
            }
        }
