<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D ìŠ¤íƒ€ì¼ RPG ì „íˆ¬ ì‹œìŠ¤í…œ</title>
    <style>
        :root {
            --primary-color: #422800;
            --secondary-color: #a98467;
            --accent-color: #bc6c25;
            --background-color: #ede0d4;
            --grid-color: #ddbea9;
            --player-color: #0077b6;
            --enemy-color: #d62828;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--primary-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        .game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .battle-grid {
            flex: 2;
            min-width: 600px;
            height: 600px;
            background-color: #5a3921;
            border: 2px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="50" height="50" x="0" y="0" fill="%23654321" /><rect width="50" height="50" x="50" y="50" fill="%23654321" /><rect width="50" height="50" x="50" y="0" fill="%23765432" /><rect width="50" height="50" x="0" y="50" fill="%23765432" /></svg>');
            background-size: 60px 60px;
        }

        .cell {
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .cell:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .wall {
            background-color: #2f2f2f;
        }

        .water {
            background-color: #4a80bd;
        }

        .high-ground {
            background-color: #8d6e63;
        }

        .character {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 10;
            cursor: grab;
            transition: all 0.3s ease;
        }

        .player {
            background-color: var(--player-color);
            color: white;
            border: 2px solid #004c8c;
        }

        .enemy {
            background-color: var(--enemy-color);
            color: white;
            border: 2px solid #9e0000;
        }

        .ui-panel {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .character-sheet, .action-panel, .log-panel, .terrain-tools {
            background-color: #f5f5f5;
            border: 1px solid var(--secondary-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .character-sheet h3, .action-panel h3, .log-panel h3, .terrain-tools h3 {
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 8px;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat {
            display: flex;
            justify-content: space-between;
        }

        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px 0;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: #a85c21;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .btn-terrain {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            font-size: 20px;
        }

        .log-content {
            height: 150px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 8px;
            background-color: #fff;
            font-size: 14px;
        }

        .log-entry {
            margin-bottom: 4px;
            padding-bottom: 4px;
            border-bottom: 1px solid #eee;
        }

        .log-player {
            color: var(--player-color);
        }

        .log-enemy {
            color: var(--enemy-color);
        }

        .log-system {
            color: #555;
            font-style: italic;
        }

        .health-bar {
            height: 10px;
            background-color: #e63946;
            border-radius: 5px;
            margin-top: 5px;
        }

        .dice-roller {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ccc;
        }

        .dice {
            font-size: 24px;
            margin: 0 5px;
        }

        @media (max-width: 950px) {
            .game-container {
                flex-direction: column;
            }
            .battle-grid {
                min-width: 100%;
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>D&D ìŠ¤íƒ€ì¼ RPG ì „íˆ¬ ì‹œìŠ¤í…œ</h1>
        <p>ìºë¦­í„°ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì´ë™ì‹œí‚¤ê³ , ëŠ¥ë ¥ì¹˜ì™€ í–‰ë™ì„ ê´€ë¦¬í•˜ì„¸ìš”.</p>
    </header>

    <div class="game-container">
        <div class="battle-grid">
            <div class="grid" id="battleGrid"></div>
        </div>

        <div class="ui-panel">
            <div class="character-sheet">
                <h3>ìºë¦­í„° ì •ë³´</h3>
                <div id="characterInfo">
                    <h4 id="charName">ì•„ë¬´ ìºë¦­í„°ë„ ì„ íƒë˜ì§€ ì•ŠìŒ</h4>
                    <div class="health-container">
                        <div class="stat">
                            <span>HP:</span>
                            <span id="charHP">-</span>
                        </div>
                        <div class="health-bar" id="healthBar" style="width: 0%"></div>
                    </div>
                    <div class="stats" id="charStats">
                        <div class="stat">
                            <span>í˜:</span>
                            <span>-</span>
                        </div>
                        <div class="stat">
                            <span>ë¯¼ì²©:</span>
                            <span>-</span>
                        </div>
                        <div class="stat">
                            <span>ì²´ë ¥:</span>
                            <span>-</span>
                        </div>
                        <div class="stat">
                            <span>ì§€ëŠ¥:</span>
                            <span>-</span>
                        </div>
                        <div class="stat">
                            <span>ì§€í˜œ:</span>
                            <span>-</span>
                        </div>
                        <div class="stat">
                            <span>ë§¤ë ¥:</span>
                            <span>-</span>
                        </div>
                    </div>
                </div>
                <div class="dice-roller">
                    <h4>ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</h4>
                    <div class="btn-group">
                        <button class="btn" onclick="rollDice(4)">D4</button>
                        <button class="btn" onclick="rollDice(6)">D6</button>
                        <button class="btn" onclick="rollDice(8)">D8</button>
                        <button class="btn" onclick="rollDice(10)">D10</button>
                        <button class="btn" onclick="rollDice(12)">D12</button>
                        <button class="btn" onclick="rollDice(20)">D20</button>
                    </div>
                    <div id="diceResult" style="margin-top: 10px; font-size: 18px;">ê²°ê³¼: -</div>
                </div>
            </div>

            <div class="action-panel">
                <h3>í–‰ë™</h3>
                <div class="btn-group">
                    <button class="btn" id="attackBtn" disabled>ê³µê²©</button>
                    <button class="btn" id="moveBtn" disabled>ì´ë™</button>
                    <button class="btn" id="skillBtn" disabled>ìŠ¤í‚¬</button>
                    <button class="btn" id="itemBtn" disabled>ì•„ì´í…œ</button>
                </div>
                <div id="actionResult" style="margin-top: 10px;"></div>
            </div>

            <div class="terrain-tools">
                <h3>ì§€í˜• ë„êµ¬</h3>
                <div class="btn-group">
                    <button class="btn btn-terrain" id="normalTerrain" title="ì¼ë°˜ ì§€í˜•">ğŸŸ«</button>
                    <button class="btn btn-terrain" id="wallTerrain" title="ë²½">â¬›</button>
                    <button class="btn btn-terrain" id="waterTerrain" title="ë¬¼">ğŸŸ¦</button>
                    <button class="btn btn-terrain" id="highGroundTerrain" title="ë†’ì€ ì§€í˜•">ğŸŸ§</button>
                    <button class="btn" id="addPlayer">í”Œë ˆì´ì–´ ì¶”ê°€</button>
                    <button class="btn" id="addEnemy">ì  ì¶”ê°€</button>
                    <button class="btn" id="resetGrid">ì§€í˜• ì´ˆê¸°í™”</button>
                </div>
            </div>

            <div class="log-panel">
                <h3>ì „íˆ¬ ë¡œê·¸</h3>
                <div class="log-content" id="battleLog">
                    <div class="log-entry log-system">ì „íˆ¬ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ìºë¦­í„°ë¥¼ ì„ íƒí•˜ê³  í–‰ë™ì„ ì·¨í•˜ì„¸ìš”.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ ê´€ë¦¬
        const gameState = {
            characters: [],
            selectedCharacter: null,
            selectedTerrain: 'normal',
            currentTurn: 0,
            battleLog: []
        };

        // ìºë¦­í„° í´ë˜ìŠ¤
        class Character {
            constructor(name, type, x, y) {
                this.id = Date.now() + Math.floor(Math.random() * 1000);
                this.name = name;
                this.type = type; // 'player' ë˜ëŠ” 'enemy'
                this.x = x;
                this.y = y;
                this.stats = {
                    strength: this.rollStat(),
                    dexterity: this.rollStat(),
                    constitution: this.rollStat(),
                    intelligence: this.rollStat(),
                    wisdom: this.rollStat(),
                    charisma: this.rollStat()
                };
                this.maxHp = 10 + this.getModifier(this.stats.constitution);
                this.hp = this.maxHp;
                this.level = 1;
                this.armorClass = 10 + this.getModifier(this.stats.dexterity);
                this.initiative = this.rollDice(20) + this.getModifier(this.stats.dexterity);
            }

            rollStat() {
                // 4d6, ê°€ì¥ ë‚®ì€ ì£¼ì‚¬ìœ„ ì œì™¸
                const rolls = [
                    Math.floor(Math.random() * 6) + 1,
                    Math.floor(Math.random() * 6) + 1,
                    Math.floor(Math.random() * 6) + 1,
                    Math.floor(Math.random() * 6) + 1
                ];
                return rolls.sort((a, b) => a - b).slice(1).reduce((sum, val) => sum + val, 0);
            }

            rollDice(sides) {
                return Math.floor(Math.random() * sides) + 1;
            }

            getModifier(stat) {
                return Math.floor((stat - 10) / 2);
            }

            attack(target) {
                const attackRoll = this.rollDice(20);
                const modifier = this.getModifier(this.stats.strength);
                const totalRoll = attackRoll + modifier;
                
                const attackMessage = `${this.name}ì´(ê°€) ${target.name}ì—ê²Œ ê³µê²©ì„ ì‹œë„í•©ë‹ˆë‹¤. (ì£¼ì‚¬ìœ„: ${attackRoll} + ìˆ˜ì •ì¹˜: ${modifier} = ${totalRoll})`;
                addLogEntry(attackMessage, this.type);

                if (totalRoll >= target.armorClass) {
                    // ê³µê²© ì„±ê³µ
                    const damageRoll = this.rollDice(6);
                    const damageTotal = Math.max(1, damageRoll + modifier);
                    target.hp = Math.max(0, target.hp - damageTotal);
                    
                    const damageMessage = `${this.name}ì´(ê°€) ${target.name}ì—ê²Œ ${damageTotal}ì˜ í”¼í•´ë¥¼ ì…í˜”ìŠµë‹ˆë‹¤! (${target.name} HP: ${target.hp}/${target.maxHp})`;
                    addLogEntry(damageMessage, this.type);
                    
                    if (target.hp <= 0) {
                        const defeatMessage = `${target.name}ì´(ê°€) ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤!`;
                        addLogEntry(defeatMessage, 'system');
                    }
                    return true;
                } else {
                    // ê³µê²© ì‹¤íŒ¨
                    const missMessage = `${this.name}ì˜ ê³µê²©ì´ ë¹—ë‚˜ê°”ìŠµë‹ˆë‹¤! (${target.name}ì˜ ë°©ì–´ë„: ${target.armorClass})`;
                    addLogEntry(missMessage, this.type);
                    return false;
                }
            }
        }

        // DOM ìš”ì†Œ ì°¸ì¡°
        const battleGrid = document.getElementById('battleGrid');
        const battleLog = document.getElementById('battleLog');
        const attackBtn = document.getElementById('attackBtn');
        const moveBtn = document.getElementById('moveBtn');
        const skillBtn = document.getElementById('skillBtn');
        const itemBtn = document.getElementById('itemBtn');
        const diceResult = document.getElementById('diceResult');

        // ì§€í˜• ë²„íŠ¼ ì°¸ì¡°
        const normalTerrain = document.getElementById('normalTerrain');
        const wallTerrain = document.getElementById('wallTerrain');
        const waterTerrain = document.getElementById('waterTerrain');
        const highGroundTerrain = document.getElementById('highGroundTerrain');
        const addPlayerBtn = document.getElementById('addPlayer');
        const addEnemyBtn = document.getElementById('addEnemy');
        const resetGridBtn = document.getElementById('resetGrid');

        // ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
        function initGrid() {
            battleGrid.innerHTML = '';
            
            for (let row = 0; row < 10; row++) {
                for (let col = 0; col < 10; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.addEventListener('click', handleCellClick);
                    battleGrid.appendChild(cell);
                }
            }
        }

        // ìºë¦­í„° ë Œë”ë§
        function renderCharacters() {
            // ê¸°ì¡´ ìºë¦­í„° ìš”ì†Œ ì œê±°
            document.querySelectorAll('.character').forEach(el => el.remove());
            
            // ìºë¦­í„° ë‹¤ì‹œ ë Œë”ë§
            gameState.characters.forEach(character => {
                const charElement = document.createElement('div');
                charElement.className = `character ${character.type}`;
                charElement.textContent = character.name.charAt(0);
                charElement.dataset.id = character.id;
                charElement.style.left = `${(character.x * 60) + 30}px`;
                charElement.style.top = `${(character.y * 60) + 30}px`;
                
                // ë“œë˜ê·¸ ê¸°ëŠ¥ ì¶”ê°€
                charElement.draggable = true;
                charElement.addEventListener('dragstart', handleDragStart);
                charElement.addEventListener('click', () => selectCharacter(character));
                
                battleGrid.appendChild(charElement);
            });
        }

        // ìºë¦­í„° ì„ íƒ
        function selectCharacter(character) {
            gameState.selectedCharacter = character;
            updateCharacterInfo(character);
            
            // ë²„íŠ¼ í™œì„±í™”
            attackBtn.disabled = false;
            moveBtn.disabled = false;
            skillBtn.disabled = false;
            itemBtn.disabled = false;
            
            // ì„ íƒëœ ìºë¦­í„° ê°•ì¡°
            document.querySelectorAll('.character').forEach(el => {
                el.style.boxShadow = 'none';
            });
            
            const charElement = document.querySelector(`.character[data-id="${character.id}"]`);
            if (charElement) {
                charElement.style.boxShadow = '0 0 10px 5px yellow';
            }
            
            addLogEntry(`${character.name}ì„(ë¥¼) ì„ íƒí–ˆìŠµë‹ˆë‹¤.`, 'system');
        }

        // ìºë¦­í„° ì •ë³´ ì—…ë°ì´íŠ¸
        function updateCharacterInfo(character) {
            if (!character) {
                document.getElementById('charName').textContent = 'ì•„ë¬´ ìºë¦­í„°ë„ ì„ íƒë˜ì§€ ì•ŠìŒ';
                document.getElementById('charHP').textContent = '-';
                document.getElementById('healthBar').style.width = '0%';
                
                const statElements = document.querySelectorAll('#charStats .stat span:nth-child(2)');
                statElements.forEach(el => el.textContent = '-');
                return;
            }
            
            document.getElementById('charName').textContent = character.name;
            document.getElementById('charHP').textContent = `${character.hp}/${character.maxHp}`;
            document.getElementById('healthBar').style.width = `${(character.hp / character.maxHp) * 100}%`;
            
            const stats = [
                character.stats.strength,
                character.stats.dexterity,
                character.stats.constitution,
                character.stats.intelligence,
                character.stats.wisdom,
                character.stats.charisma
            ];
            
            const statElements = document.querySelectorAll('#charStats .stat span:nth-child(2)');
            statElements.forEach((el, index) => {
                const stat = stats[index];
                const modifier = Math.floor((stat - 10) / 2);
                el.textContent = `${stat} (${modifier >= 0 ? '+' + modifier : modifier})`;
            });
        }

        // ì „íˆ¬ ë¡œê·¸ì— í•­ëª© ì¶”ê°€
        function addLogEntry(message, type = 'system') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = message;
            battleLog.appendChild(entry);
            battleLog.scrollTop = battleLog.scrollHeight;
            
            // ë¡œê·¸ ê¸°ë¡ì— ì €ì¥
            gameState.battleLog.push({ message, type });
        }

        // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°
        function rollDice(sides) {
            const result = Math.floor(Math.random() * sides) + 1;
            diceResult.textContent = `ê²°ê³¼: ${result} (D${sides})`;
            
            // ì£¼ì‚¬ìœ„ íš¨ê³¼ ì¶”ê°€
            const dice = document.createElement('span');
            dice.className = 'dice';
            dice.textContent = `ğŸ²${result}`;
            dice.style.position = 'absolute';
            dice.style.left = `${Math.random() * 300}px`;
            dice.style.top = `${Math.random() * 100}px`;
            dice.style.opacity = '1';
            dice.style.transform = 'scale(1)';
            dice.style.transition = 'all 1s ease-out';
            
            document.querySelector('.dice-roller').appendChild(dice);
            
            setTimeout(() => {
                dice.style.opacity = '0';
                dice.style.transform = 'scale(0.5) translateY(-20px)';
            }, 100);
            
            setTimeout(() => {
                dice.remove();
            }, 1100);
            
            return result;
        }

        // ì…€ í´ë¦­ í•¸ë“¤ëŸ¬
        function handleCellClick(event) {
            const row = parseInt(event.target.dataset.row);
            const col = parseInt(event.target.dataset.col);
            
            // ì„ íƒëœ ì§€í˜• ì ìš©
            if (gameState.selectedTerrain === 'normal') {
                event.target.className = 'cell';
            } else {
                event.target.className = `cell ${gameState.selectedTerrain}`;
            }
        }

        // ë“œë˜ê·¸ ì‹œì‘ í•¸ë“¤ëŸ¬
        function handleDragStart(event) {
            const charId = event.target.dataset.id;
            const character = gameState.characters.find(c => c.id.toString() === charId);
            
            if (character) {
                selectCharacter(character);
                event.dataTransfer.setData('text/plain', charId);
                event.dataTransfer.effectAllowed = 'move';
            }
        }

        // ë“œë˜ê·¸ ì˜ì—­ ì„¤ì •
        battleGrid.addEventListener('dragover', function(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
        });

        // ë“œë¡­ í•¸ë“¤ëŸ¬
        battleGrid.addEventListener('drop', function(event) {
            event.preventDefault();
            const charId = event.dataTransfer.getData('text/plain');
            const character = gameState.characters.find(c => c.id.toString() === charId);
            
            if (character) {
                // ê·¸ë¦¬ë“œ í¬ê¸°ë¥¼ ê³ ë ¤í•˜ì—¬ ìœ„ì¹˜ ê³„ì‚°
                const rect = battleGrid.getBoundingClientRect();
                const x = Math.floor((event.clientX - rect.left) / 60);
                const y = Math.floor((event.clientY - rect.top) / 60);
                
                // ê·¸ë¦¬ë“œ ê²½ê³„ í™•ì¸
                if (x >= 0 && x < 10 && y >= 0 && y < 10) {
                    character.x = x;
                    character.y = y;
                    addLogEntry(`${character.name}ì´(ê°€) ì´ë™í–ˆìŠµë‹ˆë‹¤.`, character.type);
                    renderCharacters();
                }
            }
        });

        // ì§€í˜• ì„ íƒ ë²„íŠ¼ ì´ë²¤íŠ¸
        normalTerrain.addEventListener('click', () => {
            gameState.selectedTerrain = 'normal';
            highlightSelectedTerrain(normalTerrain);
        });

        wallTerrain.addEventListener('click', () => {
            gameState.selectedTerrain = 'wall';
            highlightSelectedTerrain(wallTerrain);
        });

        waterTerrain.addEventListener('click', () => {
            gameState.selectedTerrain = 'water';
            highlightSelectedTerrain(waterTerrain);
        });

        highGroundTerrain.addEventListener('click', () => {
            gameState.selectedTerrain = 'high-ground';
            highlightSelectedTerrain(highGroundTerrain);
        });

        // ì„ íƒëœ ì§€í˜• ë²„íŠ¼ ê°•ì¡°
        function highlightSelectedTerrain(button) {
            document.querySelectorAll('.btn-terrain').forEach(btn => {
                btn.style.boxShadow = 'none';
            });
            button.style.boxShadow = '0 0 5px 2px var(--accent-color)';
        }

        // í”Œë ˆì´ì–´ ì¶”ê°€
        addPlayerBtn.addEventListener('click', () => {
            const playerCount = gameState.characters.filter(c => c.type === 'player').length;
            const playerName = prompt('í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', `í”Œë ˆì´ì–´ ${playerCount + 1}`);
            
            if (playerName) {
                const player = new Character(
                    playerName,
                    'player',
                    Math.floor(Math.random() * 3),
                    Math.floor(Math.random() * 10)
                );
                
                gameState.characters.push(player);
                addLogEntry(`${playerName}ì´(ê°€) ì „íˆ¬ì— ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤.`, 'player');
                renderCharacters();
            }
        });

        // ì  ì¶”ê°€
        addEnemyBtn.addEventListener('click', () => {
            const enemyCount = gameState.characters.filter(c => c.type === 'enemy').length;
            const enemyName = prompt('ì  ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', `ì  ${enemyCount + 1}`);
            
            if (enemyName) {
                const enemy = new Character(
                    enemyName,
                    'enemy',
                    7 + Math.floor(Math.random() * 3),
                    Math.floor(Math.random() * 10)
                );
                
                gameState.characters.push(enemy);
                addLogEntry(`${enemyName}ì´(ê°€) ì „íˆ¬ì— ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤!`, 'enemy');
                renderCharacters();
            }
        });

        // ê³µê²© ë²„íŠ¼ ì´ë²¤íŠ¸
        attackBtn.addEventListener('click', () => {
            if (!gameState.selectedCharacter) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            // ê°€ì¥ ê°€ê¹Œìš´ ì  ì°¾ê¸°
            const attacker = gameState.selectedCharacter;
            const targets = gameState.characters.filter(c => c.type !== attacker.type && c.hp > 0);
            
            if (targets.length === 0) {
                addLogEntry('ê³µê²©í•  ëŒ€ìƒì´ ì—†ìŠµë‹ˆë‹¤.', 'system');
                return;
            }
            
            // ê°„ë‹¨í•˜ê²Œ ì²« ë²ˆì§¸ ì ì„ ê³µê²©
            const target = targets[0];
            
            // ê³µê²© ì‹¤í–‰
            attacker.attack(target);
            
            // ì—…ë°ì´íŠ¸
            renderCharacters();
            updateCharacterInfo(attacker);
        });

        // ì´ë™ ë²„íŠ¼ ì´ë²¤íŠ¸
        moveBtn.addEventListener('click', () => {
            if (!gameState.selectedCharacter) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            addLogEntry('ìºë¦­í„°ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì´ë™ì‹œí‚¤ì„¸ìš”.', 'system');
        });

        // ì´ˆê¸°í™” ë²„íŠ¼
        resetGridBtn.addEventListener('click', () => {
            if (confirm('ì§€í˜•ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                initGrid();
                addLogEntry('ì§€í˜•ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'system');
            }
        });

        // ì´ˆê¸°í™”
        function init() {
            initGrid();
            renderCharacters();
            highlightSelectedTerrain(normalTerrain);
            
            // ê¸°ë³¸ ìºë¦­í„° ìƒì„±
            const player = new Character('ìš©ì‚¬', 'player', 2, 5);
            const enemy = new Character('ê³ ë¸”ë¦°', 'enemy', 7, 5);
            
            gameState.characters.push(player, enemy);
            renderCharacters();
            
            addLogEntry('ì „íˆ¬ ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìºë¦­í„°ë¥¼ ì„ íƒí•˜ê³  í–‰ë™ì„ ì·¨í•˜ì„¸ìš”.', 'system');
        }

        // í˜ì´ì§€ ë¡œë”© ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', init);
    </script>
</body>
</html>